暑假规划应用（SummerVacationPlanning）开发改进计划
积分统计系统修复分支合并与部署

背景: 当前主分支可能存在积分统计逻辑错误，导致仪表盘数据无法正确加载
GitHub
。开发人员已在fix/statistics-and-points-system分支中修复相关问题，需要将此修复合并回主分支并验证其效果。

具体开发需求: 将修复积分统计问题的分支代码合并到主分支。在合并后进行充分的功能验证和回归测试，重点检查积分计算和周统计功能是否准确无误。最后部署更新版本到生产环境，确保上线后仪表盘的统计数据正常显示，无无限加载或错误。

优先级: 高
预估工作量: M

验收标准:

仪表盘统计数据（如每周任务完成率、总积分）准确显示，不再出现无限加载或数据错误
GitHub
。

合并代码后，所有相关单元测试和集成测试通过，未引入新的回归问题。

新版本成功部署到生产环境，实际使用中统计相关功能表现正常，历史问题已解决。

家长端积分兑换请求审批功能

背景: 当前系统已列出可兑换的特殊奖励，但缺少孩子发起兑换请求及家长审批的完整流程
GitHub
。这可能导致孩子在未经家长许可的情况下扣减积分兑换奖励，需要补全家长端审批功能以符合预期流程。

具体开发需求: 在家长控制台增加“兑换请求审批”模块。家长登录后可查看孩子提交的积分兑换特殊奖励申请列表（包含奖励名称、所需积分等），并可对每条申请执行批准或拒绝操作（可附加备注）。实现兑换审批的前后端逻辑：当孩子发起兑换请求时（调用已有或新建API，如POST /rewards/special/request），创建记录状态为pending；家长审批通过则调用PUT /rewards/special/{id}/approve扣减积分并标记兑换完成，拒绝则调用PUT /rewards/special/{id}/reject保持积分不变仅关闭请求
GitHub
。前端需相应更新：孩子端提供提交兑换请求的界面，家长端提供审批界面。

优先级: 高
预估工作量: M

验收标准:

孩子端可以选择一项特殊奖励并成功提交积分兑换请求（若积分不足则无法提交）
GitHub
。

家长端界面显示所有待审批的兑换请求，包括奖励详情和所需积分。

家长点击“批准”后，对应积分从孩子账户扣除，兑换请求状态变为“已批准”；点击“拒绝”则不扣积分，状态变为“已拒绝”。

兑换审批操作成功更新数据库记录，并在前端及时反映结果（如孩子端积分余额和奖励状态更新）。

家长审批页面易于使用，可查看孩子备注并在审批时填写反馈意见。

积分机制平衡优化与测试

背景: 当前积分计算和上限规则需要进一步验证和调整，以确保不同任务难度和类型的积分奖励公平合理
GitHub
。目前虽然实现了按活动类别的每日积分限制，但缺少全局每日上限及每周累积上限的严格执行
GitHub
。此外，简单任务与困难任务的积分差异可能不够明显，需要校准算法提升平衡性。

具体开发需求:

每日积分上限: 在PointsRule或配置文件中增加全局每日最高积分限制参数，并在后端计算积分时检查用户当天总积分不超过该上限（如超出则截断额外积分或阻止继续完成任务）
GitHub
。

每周积分累积: 利用现有weeklyAccumulationLimit配置，在每周末检查用户未兑换的剩余积分是否超过上限，必要时发出提示或强制清零，防止积分无限累积。

积分算法校准: 调整calculateConfigurablePoints算法逻辑，根据任务难度、预计时长等因素重新校准积分计算，使困难任务获得更高的基础分或倍率奖励，确保简单任务与困难任务的积分比例合理
GitHub
。更新PointsRule配置中的难度系数等参数并进行验证。

测试验证: 编写和完善单元测试，覆盖积分计算的主要场景，包括不同难度任务积分、每日上限触发、连续完成任务勋章加成等，确保积分机制调整后无漏洞。

优先级: 高
预估工作量: M

验收标准:

在测试环境模拟用户当天完成多项任务，当总积分达到设定上限时，系统不再继续累积额外积分或提示已达上限，确保每日总积分不超出限制。

调整后的积分算法经测试验证：在相同条件下，选择困难任务获得的积分明显高于简单任务，难度系数作用生效；连续任务勋章奖励正确应用，达到条件时积分按预期增加。

所有新添和既有的积分相关单元测试全部通过，测试覆盖了上限规则和积分公式的主要分支逻辑。

前后端积分相关接口在调整后保持稳定，未出现异常错误，实际使用中积分发放与扣减符合新的规则。

关键用户流程集成测试

背景: 实现上述改动后，需要通过端到端测试确保整个系统的关键用户流程都正常运作，没有出现新的缺陷
GitHub
。这些流程包括任务从创建到家长审批、积分到账，以及积分兑换和游戏时间管理等完整场景。

具体开发需求:

使用真实或模拟用户账户进行端到端测试，覆盖主要使用流程：学生规划任务 -> 完成打卡 -> 家长审批 -> 积分到账；积分兑换 -> 家长审批 -> 奖励发放；游戏时间兑换 -> 游戏时间使用 -> 剩余时间统计更新
GitHub
。

检查前后端交互：确保“学生完成任务后需家长审批通过才获得积分”、“兑换奖励需家长批准才扣减积分”、“游戏时间兑换增加的分钟数在使用时不能超出可用余量”等业务规则在实际操作中正确执行。

记录并修复测试过程中发现的任何问题，例如接口错误、数据不同步、权限控制漏洞或前端界面异常等，确保各流程顺畅无误。

优先级: 高
预估工作量: M

验收标准:

针对上述场景的端到端测试用例全部通过，涵盖正常流程和异常情况（如审批被拒绝、积分不足导致兑换失败等）。

手动模拟实际用户操作，每个流程步骤都得到预期结果：任务完成后在家长审批前学生总积分未增加，审批通过后对应积分正确累加；未审批的兑换请求不会扣减积分，批准后积分扣除并记录兑换事项；每日基础游戏时间在次日自动重置，兑换及使用过程中的时间计算准确。

完整流程测试中系统未出现崩溃或严重错误，各模块日志无异常，UI 展示与后端数据状态保持一致。

高级任务规划与日程冲突检测

背景: 目前应用仅支持将任务安排到某一天，缺少对具体时间段的计划和冲突检测。对于需要精细规划的用户，应提供高级模式以设置任务开始时间、提醒等，并避免与已有任务时间冲突
GitHub
。

具体开发需求:

前端：在任务规划页面增加“高级模式”开关。启用高级模式后，允许用户在创建每日任务时指定任务的开始时间、持续时长、优先级和提醒设置等信息。

后端：实现日程冲突检查相关接口。例如GET /daily-tasks/weekly-schedule返回用户当周所有任务的日期和时间段安排，用于前端呈现整体日历视图；GET /daily-tasks/check-conflicts接受日期和时间段参数，返回该时间范围内是否与用户已计划的任务冲突，以及可选的调整建议
GitHub
。

冲突提示：前端调用冲突检查接口，在用户选择任务时间后实时反馈结果。若时间段有冲突，提示具体哪项任务冲突并建议更改时间或日期；若无冲突则允许正常添加。

数据模型：根据需要在DailyTask模型中添加开始时间、时长等字段，并确保在任务保存和获取时处理这些字段。更新相应的验证逻辑（例如同一任务同一时间不可重复规划）。

优先级: 中
预估工作量: L

验收标准:

用户可以切换到高级模式并成功为任务设定具体的开始时间和时长信息，提交后数据库正确保存这些信息。

当用户尝试添加与已有任务时间冲突的计划时，系统立即给出冲突警告，例如“与今天14:00的数学任务冲突”，并在可能情况下提供替代方案（如建议不同时间）。

调用/daily-tasks/weekly-schedule接口能获取指定用户未来7天内每天的任务列表及时间段分布，数据准确无误；调用/daily-tasks/check-conflicts接口对各种输入时间段均返回正确的冲突判断结果。

在前端日历/日程视图中，不同任务块按时间顺序排列，无重叠显示；对冲突任务有明显标识或未被添加；整体交互体验良好，性能可接受。

任务库管理与自定义任务

背景: 任务库目前可能只包含预设的任务模板，缺乏用户自行添加任务的功能。这限制了任务内容的多样性和个性化。允许家长添加自定义任务可以丰富任务库内容，更贴合每个家庭的实际情况
GitHub
。

具体开发需求:

添加任务表单：在任务库页面提供“添加任务”按钮，点击弹出表单供家长填写任务标题、类别、预计时长、难度、推荐积分奖励等字段
GitHub
。提交表单后调用后端API（如POST /tasks）将新任务保存到任务模板库。

后端支持：确保后端POST /tasks接口校验并存储新任务，包括验证任务类别、难度等字段有效性。新任务默认状态为可用，关联当前家长或全局可见（根据需求决定是否区分私有任务库）。

任务列表刷新：前端在成功添加任务后自动刷新任务库列表，新任务立即可见且孩子端在规划任务时可以选取该任务。实现任务库列表按类别过滤和关键词搜索功能，方便用户查找任务
GitHub
。

权限控制：限制只有具有家长角色的用户才能添加/编辑任务模板；学生用户不允许进行此操作。确保新增任务不会破坏积分计算逻辑（如给出极端高积分应有额外审核或限制）。

优先级: 中
预估工作量: M

验收标准:

家长帐号可以打开“添加任务”表单，填写各项信息后成功提交，新任务出现在任务库列表顶端，信息完整无误。

学生帐号在规划任务时能够看到家长新建的任务模板，并可将其加入每日计划正常执行。

任务库列表的筛选和搜索功能运作正常：选择某一类别时列表只显示该类别任务，输入关键词时列出标题或描述匹配的任务。

后端数据库中成功存储了新任务记录，字段值符合要求；尝试提交非法数据会得到适当错误响应，前端提示用户修改。

积分历史与成就展示

背景: 当前前端对积分的展示可能局限于总积分等概要信息，缺少详细的积分获取/使用历史和成就徽章展示。增加这些功能可以让用户更直观地了解自己的努力成果和成长轨迹
GitHub
。

具体开发需求:

积分历史：在学生用户界面新增“积分历史”页面或面板，调用后端GET /auth/points-history接口获取该用户的积分变动记录列表
GitHub
。将每次积分增加（如完成任务、连击奖励）和减少（如兑换奖励）按时间顺序显示，包含日期、事件描述、积分变化数值等信息。

成就徽章：在用户仪表盘或独立的“成就”页面展示用户已获得的成就徽章和相关统计。例如显示连续完成任务天数及对应徽章（铜、银、金、钻石），当前积分等级和距下一等级所需积分，累计完成任务数量等
GitHub
。徽章可以用图标形式呈现，未获得的灰化处理，已获得的高亮显示。

数据准备：确保后端提供上述所需数据。如果points-history或成就相关接口尚未完善，需要补充实现逻辑（例如在任务完成、兑换等操作中记录历史记录，在用户模型中维护勋章与等级信息等）。

前端体验：设计美观易懂的UI，例如使用图表、进度条显示积分变动趋势和等级进度。确保页面响应流畅，即使记录较多滚动浏览也无性能问题。

优先级: 中
预估工作量: M

验收标准:

积分历史页面正确显示用户的积分获取和支出明细，每条记录的信息完整且符合实际发生的事件（如日期排序正确，描述清晰）。

成就展示部分呈现用户已获得的徽章和实时统计：当用户达到新的连续天数或积分里程碑，界面上相应徽章自动亮起，等级进度条实时更新。

人工模拟用户获取积分和兑换的过程，确认积分历史有新增记录且内容准确；达到成就条件时，徽章状态随之改变。

后端接口支持良好，多个用户的历史和成就数据都可正确获取；大量记录情况下页面加载和切换仍然流畅。

游戏时间使用前端支持

背景: 应用支持用积分兑换游戏时间，但目前缺少孩子实际使用游戏时间的前端交互。孩子兑换了游戏时间后，系统需要记录他们何时开始玩、玩了多久，以实现对游戏时间的有效监管
GitHub
。

具体开发需求:

在儿童用户界面增加“开始游戏”按钮。点击后弹出对话框让孩子选择本次要使用的游戏时间长度（例如5分钟、10分钟等）。

确认后调用后端POST /rewards/game-time/use接口，提交所使用的分钟数。后端应验证用户当前剩余可用游戏时间是否足够，包括当天基础免费时间（30分钟）和已兑换的额外时间减去当天已用时间
GitHub
。若分钟数超出可用额度，返回错误提示；否则记录此次游戏时间使用。

前端在游戏开始后显示倒计时计时器，实时更新剩余时间。倒计时结束时提醒用户“本次游戏时间已用完”，并相应更新用户当天剩余游戏时间显示
GitHub
。

确保游戏时间统计逻辑正确：每天自动重置基础30分钟免费时长，兑换获得的未使用分钟累积到下一天（如果策划允许累积）；消耗顺序上优先扣除当天基础时长，再扣除兑换时间
GitHub
。

优先级: 中
预估工作量: M

验收标准:

当孩子有可用游戏时间时，“开始游戏”按钮处于可用状态；若当天无剩余时间则按钮禁用或提示不可用。

孩子选择一定分钟数后，系统正确扣减该时间：如果选择的分钟数不超过可用余额，倒计时开始并扣除相应分钟；如果超出余额，操作被拒绝并有提示。

倒计时过程中和结束后，前端界面能够同步更新显示剩余游戏时间；刷新页面或重新登录后，当日剩余时间依然准确无误（说明后端记录更新成功）。

第二天登录时，基础免费游戏时间自动重置为30分钟，前一天未用完的兑换时间正确结转。多日连续测试确保时间重置和累积逻辑无误。

后端数据库中有记录每次游戏时间使用的日志，可供管理员或家长审计（例如记录使用日期、时长）。

功能完善：任务跳过/逾期处理与数据校验

背景: 系统的一些边缘情况和数据校验需要加强，以提升健壮性。例如，当某天结束时仍有“计划中”任务未完成，目前系统未对其特殊处理，需要将其标记为“跳过”以反映在统计中
GitHub
。另外，文件上传的类型/大小限制、重复提交任务等也需要更严格的校验，以避免错误和安全隐患。

具体开发需求:

任务跳过/逾期: 增加每日检查任务状态的机制。可以在后端设置定时任务或在用户新一天首次登录时触发，将前一天仍为planned状态且未完成的DailyTask标记为skipped（跳过）
GitHub
。同时在用户统计数据（如周完成率）中计入这些跳过任务，以准确反映任务完成情况。

手动跳过: 提供一个接口或管理功能允许家长手动将某个逾期未完成任务标记为跳过，以便灵活管理异常情况。前端在任务详情或家长控制台中提供相应按钮，调用后端API执行跳过操作。

上传校验: 加强任务完成证据上传的校验。限制允许上传的文件类型（例如仅图片jpeg/png和短视频mp4）和大小（例如不超过10MB），前端在选择文件时先行检查，后端在接收上传时二次验证，任何不符合要求的上传请求直接拒绝并返回错误
GitHub
。

防重复提交: 防止用户重复提交表单。例如学生点击“完成任务”后立即将按钮置为不可再次点击，后端也检查同一任务的完成请求是否已处理过，在短时间内重复的请求直接忽略或返回错误，确保每个任务不会被计分多次。

优先级: 低
预估工作量: M

验收标准:

模拟场景：某天结束时有未完成任务。第二天查看任务列表或统计数据时，该任务已被标记为“跳过”，且统计中计入一次未完成/跳过，连续完成天数等数据正确更新。

家长可以通过前端界面对逾期未完成的任务执行“跳过”操作，操作后任务状态变为跳过且不再计入待完成列表，相关统计相应调整。

上传证据时，选择不支持的文件格式或超出大小限制的文件，前端会提示错误且不允许上传；如绕过前端直接调用API，后端也拒绝处理并返回友好错误信息。

多次快速点击“完成任务”按钮不会产生重复的完成记录。通过日志或数据库验证，同一DailyTask在同一时间段只产生一条完成记录，多余的提交请求被正确拦截。

配置优化与发布准备

背景: 为了顺利上线，需要对系统配置和部署进行优化调整，确保安全和性能。一些开发阶段的配置（如硬编码的密钥、默认参数）必须替换为生产环境的安全设置。数据库索引和进程守护等部署配置也应在发布前完善，以提高运行效率和稳定性
GitHub
。

具体开发需求:

环境变量: 全面检查前后端代码，确认JWT密钥、数据库连接字符串、第三方API密钥等敏感信息未以明文写死在仓库中，而是通过环境变量读取
GitHub
。更新配置文档（如README或环境变量示例文件），指导部署时正确设置这些变量。

数据库索引: 在正式部署前运行数据库索引创建脚本（如npm run create-indexes），为关键数据表添加必要索引
GitHub
。确保任务、每日任务、用户等集合具备优化查询的索引，支撑积分统计等功能的高效执行。

进程管理: 配置和检查PM2的ecosystem文件，确保日志路径、崩溃自动重启等设置符合生产需求
GitHub
。例如开启应用意外退出自动重启，设置合适的内存上限和实例数等。测试在服务器重启或进程崩溃情况下，服务能够通过PM2自动恢复。

持续集成: （可选）配置CI/CD流程，例如利用GitHub Actions在每次合并到主分支时自动运行测试、构建项目，并部署到服务器或通知运维进行部署
GitHub
。这样可减少人为失误并加快上线节奏。

优先级: 低
预估工作量: S

验收标准:

配置检查通过：代码库中不再出现明文的敏感信息，部署时通过环境变量顺利注入关键配置，应用启动后能够正确读取并连接数据库、第三方服务等。

手动或自动执行索引创建脚本后，通过数据库管理工具确认各主要集合索引就绪（例如DailyTask集合上存在userId+date复合索引等），应用在执行复杂查询时性能良好。

使用PM2启动应用并进行容灾测试：模拟进程崩溃或服务器重启，验证PM2能够自动重启服务且应用状态正常；检查日志文件，确保重要事件和错误都有记录且没有敏感信息泄露。

（如果实施CI）在代码库中推送更新时，CI管道自动运行测试且全部通过，当出现测试失败或构建错误时能及时发现和修复；成功的构建可以无误部署到目标环境。

UX 改进与多端适配

背景: 根据测试和用户反馈，前端体验仍有可改进之处。例如孩子提交任务证据后缺少明确提示，家长端在有待审批事项时也缺乏醒目提醒。另方面，不同设备的界面适配需要优化，确保移动端使用体验良好
GitHub
。

具体开发需求:

提交反馈: 在学生端，当用户提交任务完成的证据后，增加明显的反馈（例如弹出“已提交，等待家长审批”的提示或状态标记），让孩子确认操作成功且了解下一步是等待家长审核。

提醒通知: 在家长端，当存在待审批的任务完成或积分兑换请求时，在导航栏或页面显著位置显示提醒标志（如红点或消息数量）
GitHub
。点击该提醒可快速跳转到相应的审批列表页面，以确保家长及时处理。

移动适配: 检查并优化各页面在手机、平板等小屏幕设备上的显示效果。使用响应式布局调整元素排列，避免出现横向滚动或内容溢出屏幕的情况；增大移动端按钮和触控区域，保证交互顺畅
GitHub
。

其他体验优化: 例如优化加载动画和提示文字，使其更直观；统一按钮和链接的样式与文案，让操作更加清晰；对于新用户首次使用的功能提供简短指引说明等，以提升整体易用性和用户满意度。

优先级: 低
预估工作量: S

验收标准:

学生提交任务证据后，界面立即出现提交成功并等待审批的提示，信息清晰明确。测试多次提交场景，孩子均能获得正确反馈。

家长帐号登录后，如果有待审批事项，导航菜单或首页明显位置出现红点或提醒数字；当所有待处理事项完成后，提醒标志自动消失。

在常见手机（如 iPhone 12，390px 宽度）和平板设备上访问应用，各主要页面（仪表盘、任务列表、积分页面等）布局良好，没有元件错位、裁剪或滚动异常的问题。触摸交互灵敏，没有出现点击无响应的小按钮。

经过上述改进后，邀请一些用户试用并收集反馈，普遍认为应用在提示信息明确性和移动端体验方面有明显提升。

性能监控与持续优化

背景: 系统上线后，需要对性能和稳定性进行持续监控和优化。某些功能（如每日定时统计任务完成率）涉及较重的数据库运算，应观察其执行时间和资源占用，并在必要时进行优化
GitHub
。同时，随着代码演进，增加自动化测试有助于及时发现和防止性能或功能回归问题。

具体开发需求:

关键性能监控: 在后端为关键流程添加性能日志。例如记录每日统计任务或周报生成所花时间、处理的数据量等
GitHub
。如果有条件，引入应用性能监控工具（APM），追踪API响应时间、数据库查询耗时、内存CPU使用等指标，在系统运行过程中收集这些数据。

异常日志: 加强对游戏时间兑换、积分变动、任务完成等重要操作的日志记录
GitHub
。当发生异常（如积分计算结果不符合预期，定时任务执行失败等）时，系统应有详细的错误日志，便于开发者及时发现问题。

持续测试: 扩大自动化测试覆盖率，特别是对积分、任务、兑换等核心模块增加单元测试和集成测试
GitHub
。将测试运行集成到CI流水线，在每次代码更改时自动执行，确保新提交不会破坏现有功能或显著降低性能。

优化预研: 基于监控数据制定优化计划。如发现某些数据库查询缓慢，则考虑增加索引或改进查询；如果每日统计耗时过长，则考虑将其拆分为多步或引入缓存机制等。提前进行压力测试，在模拟高并发情况下找出瓶颈并优化，确保系统能稳定支撑预期的用户规模。

优先级: 低
预估工作量: M

验收标准:

在生产环境运行一段时间后，能够收集到完整的性能指标数据（例如日志显示每日统计任务处理了 N 条记录耗时 M 秒）。这些数据没有明显异常（如耗时逐日增加等）。

刻意制造某些异常场景（如数据库连接中断、积分超出范围等），系统均能通过日志捕获错误并正常恢复或处理，没有发生数据不一致或崩溃。

自动化测试覆盖率相比之前有明显提升，对核心功能的关键路径均有测试覆盖。CI中持续集成测试通过率保持 100%，当有测试失败时开发团队能在发布前及时修复。

根据监控数据执行过至少一次性能优化，例如将某个查询响应时间从 2 秒降低到 0.5 秒等。通过压力测试验证优化效果，在高并发或大量数据情况下系统性能和稳定性满足要求。