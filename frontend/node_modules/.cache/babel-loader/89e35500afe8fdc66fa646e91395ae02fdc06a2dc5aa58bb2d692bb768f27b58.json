{"ast":null,"code":"import React,{useState,useRef}from'react';import{uploadService}from'../services/upload';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FileUpload=_ref=>{let{onUploadComplete,onUploadError,userId,taskId,acceptedTypes,maxFiles=5,className=''}=_ref;const[uploading,setUploading]=useState(false);const[uploadProgress,setUploadProgress]=useState({});const[dragActive,setDragActive]=useState(false);const fileInputRef=useRef(null);const getAcceptString=()=>{const typeMap={image:'image/*',video:'video/*',audio:'audio/*'};return acceptedTypes.map(type=>typeMap[type]).join(',');};const handleFiles=async files=>{const fileArray=Array.from(files).slice(0,maxFiles);if(fileArray.length===0)return;try{setUploading(true);setUploadProgress({});const results=await uploadService.uploadMultipleFiles(fileArray,userId,taskId,(fileIndex,progress)=>{setUploadProgress(prev=>({...prev,[fileIndex]:progress.progress}));});onUploadComplete(results);setUploadProgress({});}catch(error){onUploadError(error.message||'‰∏ä‰º†Â§±Ë¥•');}finally{setUploading(false);}};const handleDrag=e=>{e.preventDefault();e.stopPropagation();if(e.type==='dragenter'||e.type==='dragover'){setDragActive(true);}else if(e.type==='dragleave'){setDragActive(false);}};const handleDrop=e=>{e.preventDefault();e.stopPropagation();setDragActive(false);if(e.dataTransfer.files&&e.dataTransfer.files.length>0){handleFiles(e.dataTransfer.files);}};const handleFileInput=e=>{if(e.target.files&&e.target.files.length>0){handleFiles(e.target.files);}};const getTypeIcons=()=>{const iconMap={image:'üì∏',video:'üé•',audio:'üéµ'};return acceptedTypes.map(type=>iconMap[type]).join(' ');};const getTypeText=()=>{const textMap={image:'ÂõæÁâá',video:'ËßÜÈ¢ë',audio:'Èü≥È¢ë'};return acceptedTypes.map(type=>textMap[type]).join('„ÄÅ');};return/*#__PURE__*/_jsx(\"div\",{className:className,children:/*#__PURE__*/_jsxs(\"div\",{className:`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-200 ${dragActive?'border-primary-400 bg-primary-50':uploading?'border-secondary-400 bg-secondary-50':'border-gray-300 hover:border-gray-400'}`,onDragEnter:handleDrag,onDragLeave:handleDrag,onDragOver:handleDrag,onDrop:handleDrop,children:[/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",multiple:true,accept:getAcceptString(),onChange:handleFileInput,className:\"hidden\"}),uploading?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-4xl\",children:\"\\u23F3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-lg font-medium text-secondary-700\",children:\"\\u4E0A\\u4F20\\u4E2D...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 space-y-2\",children:Object.entries(uploadProgress).map(_ref2=>{let[fileIndex,progress]=_ref2;return/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-gray-600 mb-1\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u6587\\u4EF6 \",parseInt(fileIndex)+1]}),/*#__PURE__*/_jsxs(\"span\",{children:[Math.round(progress),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-secondary-600 h-2 rounded-full transition-all duration-300\",style:{width:`${progress}%`}})})]},fileIndex);})})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-4xl\",children:getTypeIcons()}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-medium text-gray-900\",children:[\"\\u4E0A\\u4F20\",getTypeText(),\"\\u6587\\u4EF6\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mt-1\",children:[\"\\u62D6\\u62FD\\u6587\\u4EF6\\u5230\\u8FD9\\u91CC\\uFF0C\\u6216\\u8005\",/*#__PURE__*/_jsx(\"button\",{onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},className:\"text-primary-600 hover:text-primary-700 font-medium ml-1\",children:\"\\u70B9\\u51FB\\u9009\\u62E9\\u6587\\u4EF6\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-400 mt-2\",children:[\"\\u6700\\u591A\",maxFiles,\"\\u4E2A\\u6587\\u4EF6\\uFF0C\\u6BCF\\u4E2A\\u6587\\u4EF6\\u6700\\u592710MB\"]})]})]})]})});};export default FileUpload;","map":{"version":3,"names":["React","useState","useRef","uploadService","jsx","_jsx","jsxs","_jsxs","FileUpload","_ref","onUploadComplete","onUploadError","userId","taskId","acceptedTypes","maxFiles","className","uploading","setUploading","uploadProgress","setUploadProgress","dragActive","setDragActive","fileInputRef","getAcceptString","typeMap","image","video","audio","map","type","join","handleFiles","files","fileArray","Array","from","slice","length","results","uploadMultipleFiles","fileIndex","progress","prev","error","message","handleDrag","e","preventDefault","stopPropagation","handleDrop","dataTransfer","handleFileInput","target","getTypeIcons","iconMap","getTypeText","textMap","children","onDragEnter","onDragLeave","onDragOver","onDrop","ref","multiple","accept","onChange","Object","entries","_ref2","parseInt","Math","round","style","width","onClick","_fileInputRef$current","current","click"],"sources":["/root/projects/SummerVacationPlanning/frontend/src/components/FileUpload.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { uploadService, UploadResult } from '../services/upload';\n\ninterface FileUploadProps {\n  onUploadComplete: (files: UploadResult[]) => void;\n  onUploadError: (error: string) => void;\n  userId: string;\n  taskId: string;\n  acceptedTypes: ('image' | 'video' | 'audio')[];\n  maxFiles?: number;\n  className?: string;\n}\n\nconst FileUpload: React.FC<FileUploadProps> = ({\n  onUploadComplete,\n  onUploadError,\n  userId,\n  taskId,\n  acceptedTypes,\n  maxFiles = 5,\n  className = '',\n}) => {\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState<{ [key: number]: number }>({});\n  const [dragActive, setDragActive] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const getAcceptString = () => {\n    const typeMap = {\n      image: 'image/*',\n      video: 'video/*',\n      audio: 'audio/*',\n    };\n    return acceptedTypes.map(type => typeMap[type]).join(',');\n  };\n\n  const handleFiles = async (files: FileList) => {\n    const fileArray = Array.from(files).slice(0, maxFiles);\n    \n    if (fileArray.length === 0) return;\n\n    try {\n      setUploading(true);\n      setUploadProgress({});\n\n      const results = await uploadService.uploadMultipleFiles(\n        fileArray,\n        userId,\n        taskId,\n        (fileIndex, progress) => {\n          setUploadProgress(prev => ({\n            ...prev,\n            [fileIndex]: progress.progress,\n          }));\n        }\n      );\n\n      onUploadComplete(results);\n      setUploadProgress({});\n    } catch (error: any) {\n      onUploadError(error.message || '‰∏ä‰º†Â§±Ë¥•');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true);\n    } else if (e.type === 'dragleave') {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    \n    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      handleFiles(e.dataTransfer.files);\n    }\n  };\n\n  const handleFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      handleFiles(e.target.files);\n    }\n  };\n\n  const getTypeIcons = () => {\n    const iconMap = {\n      image: 'üì∏',\n      video: 'üé•',\n      audio: 'üéµ',\n    };\n    return acceptedTypes.map(type => iconMap[type]).join(' ');\n  };\n\n  const getTypeText = () => {\n    const textMap = {\n      image: 'ÂõæÁâá',\n      video: 'ËßÜÈ¢ë',\n      audio: 'Èü≥È¢ë',\n    };\n    return acceptedTypes.map(type => textMap[type]).join('„ÄÅ');\n  };\n\n  return (\n    <div className={className}>\n      <div\n        className={`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-200 ${\n          dragActive\n            ? 'border-primary-400 bg-primary-50'\n            : uploading\n            ? 'border-secondary-400 bg-secondary-50'\n            : 'border-gray-300 hover:border-gray-400'\n        }`}\n        onDragEnter={handleDrag}\n        onDragLeave={handleDrag}\n        onDragOver={handleDrag}\n        onDrop={handleDrop}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          multiple\n          accept={getAcceptString()}\n          onChange={handleFileInput}\n          className=\"hidden\"\n        />\n\n        {uploading ? (\n          <div className=\"space-y-4\">\n            <div className=\"text-4xl\">‚è≥</div>\n            <div>\n              <p className=\"text-lg font-medium text-secondary-700\">‰∏ä‰º†‰∏≠...</p>\n              <div className=\"mt-2 space-y-2\">\n                {Object.entries(uploadProgress).map(([fileIndex, progress]) => (\n                  <div key={fileIndex} className=\"text-sm\">\n                    <div className=\"flex justify-between text-gray-600 mb-1\">\n                      <span>Êñá‰ª∂ {parseInt(fileIndex) + 1}</span>\n                      <span>{Math.round(progress)}%</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                      <div\n                        className=\"bg-secondary-600 h-2 rounded-full transition-all duration-300\"\n                        style={{ width: `${progress}%` }}\n                      ></div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <div className=\"text-4xl\">{getTypeIcons()}</div>\n            <div>\n              <p className=\"text-lg font-medium text-gray-900\">\n                ‰∏ä‰º†{getTypeText()}Êñá‰ª∂\n              </p>\n              <p className=\"text-sm text-gray-500 mt-1\">\n                ÊãñÊãΩÊñá‰ª∂Âà∞ËøôÈáåÔºåÊàñËÄÖ\n                <button\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"text-primary-600 hover:text-primary-700 font-medium ml-1\"\n                >\n                  ÁÇπÂáªÈÄâÊã©Êñá‰ª∂\n                </button>\n              </p>\n              <p className=\"text-xs text-gray-400 mt-2\">\n                ÊúÄÂ§ö{maxFiles}‰∏™Êñá‰ª∂ÔºåÊØè‰∏™Êñá‰ª∂ÊúÄÂ§ß10MB\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default FileUpload;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}