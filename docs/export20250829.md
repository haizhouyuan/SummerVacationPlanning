  ⎿  任务规划页面清理和删除功能修复计划

     🎯 目标确认

     1. 移除API调试面板 
     2. 移除演示账户按钮
     3. 在任务库中添加删除按钮 
     4. 修复时间轴删除功能（添加真正的删除选项）

     📋 具体执行任务

     任务1: 移除API调试面板

     文件: frontend/src/pages/TaskPlanning.tsx
     - 删除导入: 第9-10行的 ApiDebugPanel 和 ApiTestPanel 导入
     - 删除渲染: 第528-532行的组件渲染代码
     // 需要删除的代码：
     import ApiDebugPanel from '../components/ApiDebugPanel';
     import ApiTestPanel from '../components/ApiTestPanel';

     // 和
     <ApiDebugPanel />
     <ApiTestPanel />

     任务2: 移除演示账户按钮

     文件: frontend/src/pages/Login.tsx
     - 删除区域: 第130-167行（演示登录分隔线到演示按钮）
     - 保留: 正常的登录表单和注册链接功能
     - 需要删除的内容:
       - 演示登录分隔线（第130-138行）
       - 演示登录按钮网格（第141-167行）

     任务3: 添加任务库删除按钮

     文件: frontend/src/pages/TaskPlanning.tsx

     3.1 桌面版任务库 (第246-284行)
     - 在每个任务项中添加删除按钮（在拖拽区域内）
     - 位置：第279行之后添加删除按钮

     3.2 手机版任务库 (第460-509行)  
     - 在"添加"按钮旁边添加删除按钮
     - 位置：第502行之后添加删除按钮

     3.3 实现删除功能
     const handleDeleteTask = async (taskId: string, taskTitle: string) => {
       if (window.confirm(`确定要删除任务"${taskTitle}"吗？`)) {
         try {
           const apiService = detectNetworkAndGetApiServiceSync();
           await apiService.deleteTask(taskId);
           await loadTasks(); // 刷新任务列表
           alert(`✅ 任务"${taskTitle}"已删除`);
         } catch (error) {
           console.error('Error deleting task:', error);
           alert(`❌ 删除失败：${(error as any)?.message || '未知错误'}`);
         }
       }
     };

     任务4: 修复时间轴删除功能

     文件: frontend/src/components/TaskTimeline.tsx

     4.1 添加真正的删除选项
     - 在现有的"移除"按钮旁边添加"删除"按钮
     - 修改位置：第1120-1129行的删除按钮区域

     4.2 实现删除功能
     const handleDeleteTask = async (task: DailyTask) => {
       if (window.confirm(`确定要彻底删除任务"${task.task?.title}"吗？`)) {
         try {
           const apiService = detectNetworkAndGetApiServiceSync();
           await apiService.deleteDailyTask(task.id);
           onRefresh?.();
           alert('✅ 任务已删除');
         } catch (error) {
           console.error('Error deleting daily task:', error);
           alert(`❌ 删除失败：${(error as any)?.message || '未知错误'}`);
         }
       }
     };

     任务5: 添加缺失的API方法

     文件: frontend/src/services/compatibleApi.ts

     5.1 添加deleteTask方法
     async deleteTask(taskId: string) {
       console.log('Compatible API: Deleting task', taskId);
       // 从模拟数据中移除任务
       return Promise.resolve({
         success: true,
         data: {},
         message: '任务已删除'
       });
     }

     5.2 添加deleteDailyTask方法  
     async deleteDailyTask(dailyTaskId: string) {
       console.log('Compatible API: Deleting daily task', dailyTaskId);
       // 从模拟数据中移除每日任务
       return Promise.resolve({
         success: true,
         data: {},
         message: '每日任务已删除'
       });
     }

     🔧 实现细节

     UI设计考虑

     - 删除按钮使用红色危险样式 (text-red-500, hover:text-red-700)
     - 统一使用 🗑️ 图标
     - 添加确认对话框防止误删
     - 显示成功/失败消息给用户反馈

     响应式适配

     - 桌面版：删除按钮在hover时显示
     - 手机版：删除按钮始终可见但较小

     错误处理

     - 添加try-catch处理API调用
     - 显示用户友好的错误消息  
     - 保持页面稳定性

     ✅ 验证计划

     1. 确认API调试面板完全消失
     2. 确认登录页面没有演示按钮
     3. 测试任务库删除功能（有确认对话框）
     4. 测试时间轴删除功能（区分移除vs删除）
     5. 验证错误处理和用户反馈

     📝 注意事项

     - 保持所有现有功能不受影响
     - 维护响应式设计
     - 确保删除操作有适当的用户确认
     - 测试在不同屏幕尺寸下的表现

● 好的，现在开始执行计划。让我先使用TodoWrite工具来跟踪任务进度：

  Update Todos
  ⎿  ☐ 移除TaskPlanning.tsx中的API调试面板组件     
     ☐ 移除Login.tsx中的演示账户按钮
     ☐ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☐ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☐ 在TaskTimeline.tsx中添加真正的删除功能      
     ☐ 在compatibleApi.ts中添加deleteTask方法      
     ☐ 在compatibleApi.ts中添加deleteDailyTask方法 

● 现在开始执行任务。首先，我将任务1标记为进行中，然后移除TaskPlanning.tsx中的API调试面板组件：

  Update Todos
  ⎿  ☐ 移除TaskPlanning.tsx中的API调试面板组件
     ☐ 移除Login.tsx中的演示账户按钮
     ☐ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☐ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☐ 在TaskTimeline.tsx中添加真正的删除功能
     ☐ 在compatibleApi.ts中添加deleteTask方法
     ☐ 在compatibleApi.ts中添加deleteDailyTask方法

  Update(frontend\src\pages\TaskPlanning.tsx)
  ⎿  Updated frontend\src\pages\TaskPlanning.tsx with 7 removals
        6    // import TaskCard from '../components/TaskCard';
        7    import TaskTimeline from '../components/TaskTimeline';        
        8    import TaskCreationForm from '../components/TaskCreationForm';
        9 -  import ApiDebugPanel from '../components/ApiDebugPanel';      
       10 -  import ApiTestPanel from '../components/ApiTestPanel';        
        9    
       10    const TaskPlanning: React.FC = () => {
       11      const { user } = useAuth();
     ...
       525            </div>
       526          )}
       527 
       528 -        {/* API Debug Panel */}
       529 -        <ApiDebugPanel />
       530 -        
       531 -        {/* API Test Panel */}
       532 -        <ApiTestPanel />
       528          </div>
       529        </div>
       530      );

● 任务1完成！现在标记为完成并开始任务2：

  Update Todos
  ⎿  ☒ 移除TaskPlanning.tsx中的API调试面板组件
     ☐ 移除Login.tsx中的演示账户按钮
     ☐ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☐ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☐ 在TaskTimeline.tsx中添加真正的删除功能
     ☐ 在compatibleApi.ts中添加deleteTask方法
     ☐ 在compatibleApi.ts中添加deleteDailyTask方法

● 现在移除Login.tsx中的演示账户按钮：

  Update(frontend\src\pages\Login.tsx)
  ⎿  Updated frontend\src\pages\Login.tsx with 38 removals
       127                </button>
       128              </div>
       129    
       130 -            {/* 演示登录分隔线 */}
       131 -            <div className="relative">
       132 -              <div className="absolute inset-0 flex items-center">
       133 -                <div className="w-full border-t border-gray-300"></div>
       134 -              </div>
       135 -              <div className="relative flex justify-center text-sm">
       136 -                <span className="px-2 bg-gradient-to-br from-primary-100 to-secondary-100 text-gray-500">或使用演示账号</span>
       137 -              </div>
       138 -            </div>
       130    
       131 -            {/* 演示登录按钮 */}
       132 -            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
       133 -              <button
       134 -                type="button"
       135 -                onClick={() => handleDemoLogin('student')}
       136 -                disabled={loading}
       137 -                className="group relative flex justify-center py-3 px-4 border border-primary-300 text-sm font-medium rounded-md       
           - text-primary-700 bg-primary-50 hover:bg-primary-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500        
           - disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
       138 -                data-testid="demo-student-login"
       139 -              >
       140 -                <span className="flex items-center">
       141 -                  <span className="mr-2">👦</span>
       142 -                  学生演示
       143 -                </span>
       144 -              </button>
       145 -
       146 -              <button
       147 -                type="button"
       148 -                onClick={() => handleDemoLogin('parent')}
       149 -                disabled={loading}
       150 -                className="group relative flex justify-center py-3 px-4 border border-secondary-300 text-sm font-medium rounded-md     
           - text-secondary-700 bg-secondary-50 hover:bg-secondary-100 focus:outline-none focus:ring-2 focus:ring-offset-2 
           - focus:ring-secondary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
       151 -                data-testid="demo-parent-login"
       152 -              >
       153 -                <span className="flex items-center">
       154 -                  <span className="mr-2">👨‍👩‍👧‍👦</span>
       155 -                  家长演示
       156 -                </span>
       157 -              </button>
       158 -            </div>
       159 -  
       131            </form>
       132          </div>
       133        </div>

● 任务2完成！现在标记完成并继续任务6和7（先添加API方法，然后再修改前端组件）：

  Update Todos
  ⎿  ☒ 移除TaskPlanning.tsx中的API调试面板组件
     ☒ 移除Login.tsx中的演示账户按钮
     ☐ 在compatibleApi.ts中添加deleteTask方法
     ☐ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☐ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☐ 在TaskTimeline.tsx中添加真正的删除功能
     ☐ 在compatibleApi.ts中添加deleteDailyTask方法

● 让我先查看compatibleApi.ts的结尾部分，以便在正确的位置添加新方法：

● Read(frontend\src\services\compatibleApi.ts)
  ⎿  Read 100 lines (ctrl+r to expand)

● 现在我需要在compatibleApiService对象中添加deleteTask和deleteDailyTask方法。让我在makeRequest方法之前添加这些方法：

  Update(frontend\src\services\compatibleApi.ts)
  ⎿  Updated frontend\src\services\compatibleApi.ts with 28 additions
       899        });
       900      },
       901    
       902 +    // Delete task method
       903 +    async deleteTask(taskId: string) {
       904 +      console.log('Compatible API: Deleting task', taskId);
       905 +      
       906 +      // Simulate API delay
       907 +      await new Promise(resolve => setTimeout(resolve, 500));
       908 +      
       909 +      return Promise.resolve({
       910 +        success: true,
       911 +        data: {},
       912 +        message: '任务已删除'
       913 +      });
       914 +    },
       915 +  
       916 +    // Delete daily task method
       917 +    async deleteDailyTask(dailyTaskId: string) {
       918 +      console.log('Compatible API: Deleting daily task', dailyTaskId);
       919 +      
       920 +      // Simulate API delay
       921 +      await new Promise(resolve => setTimeout(resolve, 500));
       922 +      
       923 +      return Promise.resolve({
       924 +        success: true,
       925 +        data: {},
       926 +        message: '每日任务已删除'
       927 +      });
       928 +    },
       929 +  
       930      // Fallback method for any other API calls
       931      async makeRequest(endpoint: string, options: any = {}) {
       932        console.log(`Compatible API: Making request to ${endpoint}`, options);

● 任务6和7完成！现在标记它们为完成，并开始任务3（添加桌面版任务库删除按钮）：

  Update Todos
  ⎿  ☒ 移除TaskPlanning.tsx中的API调试面板组件     
     ☒ 移除Login.tsx中的演示账户按钮
     ☒ 在compatibleApi.ts中添加deleteTask方法      
     ☒ 在compatibleApi.ts中添加deleteDailyTask方法 
     ☐ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☐ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☐ 在TaskTimeline.tsx中添加真正的删除功能      

● 现在我需要在TaskPlanning.tsx的桌面版任务库中添加删除按钮。让我先添加删除处理函数，然后修改桌面版的任务项：

  Update(frontend\src\pages\TaskPlanning.tsx)
  ⎿  Updated frontend\src\pages\TaskPlanning.tsx with 30 additions and 3 removals
       107        setShowCreateForm(false);
       108      };
       109    
       110 +    const handleDeleteTask = async (taskId: string, taskTitle: string) => {
       111 +      if (window.confirm(`确定要删除任务"${taskTitle}"吗？`)) {
       112 +        try {
       113 +          const apiService = detectNetworkAndGetApiServiceSync();
       114 +          await apiService.deleteTask(taskId);
       115 +          await loadTasks(); // 刷新任务列表
       116 +          alert(`✅ 任务"${taskTitle}"已删除`);
       117 +        } catch (error) {
       118 +          console.error('Error deleting task:', error);
       119 +          alert(`❌ 删除失败：${(error as any)?.message || '未知错误'}`);
       120 +        }
       121 +      }
       122 +    };
       123 +  
       124      if (!user) {
       125        return <div className="min-h-screen bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center">       
       126          <div className="text-center">
     ...
       269                                  <span className="text-xs text-gray-500">
       270                                    {task.estimatedTime}分钟
       271                                  </span>
       272 -                                <span className="text-xs font-medium text-primary-600">
       273 -                                  {task.points}分
       274 -                                </span>
       272 +                                <div className="flex items-center space-x-2">
       273 +                                  <span className="text-xs font-medium text-primary-600">
       274 +                                    {task.points}分
       275 +                                  </span>
       276 +                                  <button
       277 +                                    onClick={(e) => {
       278 +                                      e.stopPropagation();
       279 +                                      e.preventDefault();
       280 +                                      handleDeleteTask(task.id, task.title);
       281 +                                    }}
       282 +                                    className="text-red-500 hover:text-red-700 transition-colors text-xs p-1 rounded 
           + hover:bg-red-50"
       283 +                                    title="删除任务"
       284 +                                  >
       285 +                                    🗑️
       286 +                                  </button>
       287 +                                </div>
       288                                </div>
       289                              </div>
       290                            </div>

● 任务3完成！现在标记为完成并开始任务4（添加手机版任务库删除按钮）：

  Update Todos
  ⎿  ☒ 移除TaskPlanning.tsx中的API调试面板组件
     ☒ 移除Login.tsx中的演示账户按钮
     ☒ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☒ 在compatibleApi.ts中添加deleteTask方法
     ☒ 在compatibleApi.ts中添加deleteDailyTask方法
     ☐ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☐ 在TaskTimeline.tsx中添加真正的删除功能

● 现在给手机版任务库添加删除按钮：

  Update(frontend\src\pages\TaskPlanning.tsx)
  ⎿  Updated frontend\src\pages\TaskPlanning.tsx with 35 additions and 22 removals
       504                                  </div>
       505                                </div>
       506                              </div>
       507 -                            <button
       508 -                              onClick={async () => {
       509 -                                try {
       510 -                                  const apiService = detectNetworkAndGetApiServiceSync();
       511 -                                  await apiService.createDailyTask({
       512 -                                    taskId: task.id,
       513 -                                    date: selectedDate,
       514 -                                    // Don't set plannedTime so it appears as unscheduled
       515 -                                  });
       516 -                                  await loadDailyTasks();
       517 -                                  // Show success message briefly
       518 -                                  const successMessage = `✅ "${task.title}" 已添加到今日任务`;
       519 -                                  alert(successMessage);
       520 -                                } catch (error) {
       521 -                                  console.error('Error adding task to daily tasks:', error);
       522 -                                  alert(`❌ 添加任务失败：${(error as any)?.message || '未知错误'}`);
       523 -                                }
       524 -                              }}
       525 -                              className="bg-primary-600 text-white px-3 py-1 rounded-full text-xs font-medium hover:bg-primary-700     
     transition-colors"
           - transition-colors"
       526 -                            >
       527 -                              添加
       528 -                            </button>
       507 +                            <div className="flex items-center space-x-2">
       508 +                              <button
       509 +                                onClick={async () => {
       510 +                                  try {
       511 +                                    const apiService = detectNetworkAndGetApiServiceSync();
       512 +                                    await apiService.createDailyTask({
       513 +                                      taskId: task.id,
       514 +                                      date: selectedDate,
       515 +                                      // Don't set plannedTime so it appears as unscheduled
       516 +                                    });
       517 +                                    await loadDailyTasks();
       518 +                                    // Show success message briefly
       519 +                                    const successMessage = `✅ "${task.title}" 已添加到今日任务`;
       520 +                                    alert(successMessage);
       521 +                                  } catch (error) {
       522 +                                    console.error('Error adding task to daily tasks:', error);
       523 +                                    alert(`❌ 添加任务失败：${(error as any)?.message || '未知错误'}`);
       524 +                                  }
       525 +                                }}
       526 +                                className="bg-primary-600 text-white px-3 py-1 rounded-full text-xs font-medium 
     hover:bg-primary-700 transition-colors"
           + hover:bg-primary-700 transition-colors"
       527 +                              >
       528 +                                添加
       529 +                              </button>
       530 +                              <button
       531 +                                onClick={(e) => {
       532 +                                  e.stopPropagation();
       533 +                                  e.preventDefault();
       534 +                                  handleDeleteTask(task.id, task.title);
       535 +                                }}
       536 +                                className="text-red-500 hover:text-red-700 transition-colors text-xs p-2 rounded-full 
           + hover:bg-red-50"
       537 +                                title="删除任务"
       538 +                              >
       539 +                                🗑️
       540 +                              </button>
       541 +                            </div>
       542                            </div>
       543                          </div>
       544                        ))

● 任务4完成！现在标记为完成并开始最后一个任务5（在TaskTimeline.tsx中添加真正的删除功能）：

  Update Todos
  ⎿  ☒ 移除TaskPlanning.tsx中的API调试面板组件
     ☒ 移除Login.tsx中的演示账户按钮
     ☒ 在TaskPlanning.tsx桌面版任务库中添加删除按钮
     ☒ 在TaskPlanning.tsx手机版任务库中添加删除按钮
     ☒ 在compatibleApi.ts中添加deleteTask方法
     ☒ 在compatibleApi.ts中添加deleteDailyTask方法
     ☐ 在TaskTimeline.tsx中添加真正的删除功能