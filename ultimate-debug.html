<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»ˆæè°ƒè¯• - æŒ‰é’®ç‚¹å‡»é—®é¢˜</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
            line-height: 1.6;
        }
        .debug-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .test-btn {
            display: block;
            margin: 10px 0;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
        }
        .test-btn:hover {
            background: #0056b3;
            border-color: #0056b3;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ” ç»ˆææŒ‰é’®è°ƒè¯•å·¥å…·</h1>
    <p>è¿™ä¸ªé¡µé¢å°†å¸®åŠ©æˆ‘ä»¬æ‰¾å‡ºä¸ºä»€ä¹ˆæŒ‰é’®ç‚¹å‡»æ²¡æœ‰å“åº”</p>

    <div class="debug-section">
        <h2>ğŸ“ æ­¥éª¤1ï¼šåŸºç¡€JavaScriptæµ‹è¯•</h2>
        <p>æµ‹è¯•æœ€åŸºæœ¬çš„JavaScriptåŠŸèƒ½æ˜¯å¦å·¥ä½œ</p>
        <button class="test-btn" onclick="basicTest()">ç‚¹å‡»æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
        <div id="basicResult" class="status info">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="debug-section">
        <h2>ğŸ–±ï¸ æ­¥éª¤2ï¼šäº‹ä»¶ç›‘å¬æµ‹è¯•</h2>
        <p>æµ‹è¯•ä¸åŒçš„äº‹ä»¶ç»‘å®šæ–¹å¼</p>
        <button class="test-btn" id="eventTest1">onclickå±æ€§æµ‹è¯•</button>
        <button class="test-btn" id="eventTest2">addEventListeneræµ‹è¯•</button>
        <button class="test-btn" id="eventTest3">jQueryé£æ ¼æµ‹è¯•</button>
        <div id="eventResult" class="status info">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="debug-section">
        <h2>ğŸŒ æ­¥éª¤3ï¼šç½‘ç»œå’Œæ§åˆ¶å°æ£€æŸ¥</h2>
        <p>æ£€æŸ¥æµè§ˆå™¨ç¯å¢ƒå’Œç½‘ç»œçŠ¶æ€</p>
        <button class="test-btn" onclick="environmentTest()">æ£€æŸ¥æµè§ˆå™¨ç¯å¢ƒ</button>
        <div id="envResult" class="status info">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="debug-section">
        <h2>ğŸ¯ æ­¥éª¤4ï¼šæ¨¡æ‹ŸåŸå§‹é—®é¢˜</h2>
        <p>å¤åˆ¶åŸæ¥çš„quickLoginæŒ‰é’®è¡Œä¸º</p>
        <button class="test-btn" onclick="quickLogin('student')">æ¨¡æ‹Ÿå­¦ç”Ÿç™»å½•</button>
        <button class="test-btn" onclick="quickLogin('parent')">æ¨¡æ‹Ÿå®¶é•¿ç™»å½•</button>
        <div id="quickResult" class="status info">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="debug-section">
        <h2>ğŸ“‹ è°ƒè¯•æ—¥å¿—</h2>
        <button onclick="clearLog()" style="float: right; padding: 5px 10px; font-size: 12px;">æ¸…é™¤æ—¥å¿—</button>
        <div id="logArea" class="log-area">æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...\n</div>
    </div>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logArea = document.getElementById('logArea');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            logArea.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('logArea').textContent = 'æ—¥å¿—å·²æ¸…é™¤...\n';
        }

        // 1. åŸºç¡€JavaScriptæµ‹è¯•
        function basicTest() {
            log('å¼€å§‹åŸºç¡€åŠŸèƒ½æµ‹è¯•');
            const resultDiv = document.getElementById('basicResult');
            
            try {
                // æµ‹è¯•åŸºæœ¬JavaScriptåŠŸèƒ½
                const testArray = [1, 2, 3];
                const testSum = testArray.reduce((a, b) => a + b, 0);
                log(`æ•°ç»„è®¡ç®—æµ‹è¯•: ${testSum} (æœŸæœ›: 6)`);
                
                // æµ‹è¯•DOMæ“ä½œ
                const testDiv = document.createElement('div');
                testDiv.textContent = 'Test';
                log('DOMåˆ›å»ºæµ‹è¯•: æˆåŠŸ');
                
                // æµ‹è¯•localStorage
                localStorage.setItem('test', 'value');
                const testValue = localStorage.getItem('test');
                log(`localStorageæµ‹è¯•: ${testValue}`);
                localStorage.removeItem('test');
                
                // æµ‹è¯•setTimeout
                setTimeout(() => {
                    log('å¼‚æ­¥å‡½æ•°æµ‹è¯•: setTimeoutå·¥ä½œæ­£å¸¸');
                }, 100);
                
                resultDiv.textContent = 'âœ… åŸºç¡€JavaScriptåŠŸèƒ½æ­£å¸¸';
                resultDiv.className = 'status success';
                log('åŸºç¡€åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                log(`åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                resultDiv.textContent = `âŒ åŸºç¡€åŠŸèƒ½å¼‚å¸¸: ${error.message}`;
                resultDiv.className = 'status error';
            }
        }

        // 2. äº‹ä»¶æµ‹è¯•
        function setupEventTests() {
            log('è®¾ç½®äº‹ä»¶ç›‘å¬å™¨æµ‹è¯•');
            const resultDiv = document.getElementById('eventResult');
            
            // onclickå±æ€§æµ‹è¯•
            document.getElementById('eventTest1').onclick = function() {
                log('onclickå±æ€§äº‹ä»¶è§¦å‘æˆåŠŸ', 'success');
                resultDiv.textContent = 'âœ… onclickå±æ€§å·¥ä½œæ­£å¸¸';
                resultDiv.className = 'status success';
            };
            
            // addEventListeneræµ‹è¯•
            document.getElementById('eventTest2').addEventListener('click', function() {
                log('addEventListeneräº‹ä»¶è§¦å‘æˆåŠŸ', 'success');
                resultDiv.textContent = 'âœ… addEventListenerå·¥ä½œæ­£å¸¸';
                resultDiv.className = 'status success';
            });
            
            // å¤‡ç”¨äº‹ä»¶æµ‹è¯•
            const btn3 = document.getElementById('eventTest3');
            btn3.addEventListener('click', function(e) {
                log('å¤‡ç”¨äº‹ä»¶ç›‘å¬å™¨è§¦å‘', 'success');
                log(`äº‹ä»¶å¯¹è±¡: ${e.type}, ç›®æ ‡: ${e.target.tagName}`, 'info');
                resultDiv.textContent = 'âœ… å¤‡ç”¨äº‹ä»¶ç›‘å¬å·¥ä½œæ­£å¸¸';
                resultDiv.className = 'status success';
            });
        }

        // 3. ç¯å¢ƒæ£€æŸ¥
        function environmentTest() {
            log('å¼€å§‹ç¯å¢ƒæ£€æŸ¥');
            const resultDiv = document.getElementById('envResult');
            let issues = [];
            
            try {
                // æµè§ˆå™¨ä¿¡æ¯
                log(`æµè§ˆå™¨: ${navigator.userAgent}`, 'info');
                log(`å½“å‰URL: ${window.location.href}`, 'info');
                log(`åè®®: ${window.location.protocol}`, 'info');
                
                // JavaScriptåŠŸèƒ½æ£€æŸ¥
                if (typeof fetch === 'undefined') {
                    issues.push('fetch APIä¸å¯ç”¨');
                } else {
                    log('fetch APIå¯ç”¨');
                }
                
                if (typeof localStorage === 'undefined') {
                    issues.push('localStorageä¸å¯ç”¨');
                } else {
                    log('localStorageå¯ç”¨');
                }
                
                // æ§åˆ¶å°é”™è¯¯æ£€æŸ¥
                const originalConsoleError = console.error;
                let errorCount = 0;
                console.error = function(...args) {
                    errorCount++;
                    originalConsoleError.apply(console, args);
                };
                
                setTimeout(() => {
                    console.error = originalConsoleError;
                    if (errorCount > 0) {
                        log(`æ£€æµ‹åˆ° ${errorCount} ä¸ªæ§åˆ¶å°é”™è¯¯`, 'warning');
                        issues.push(`${errorCount}ä¸ªæ§åˆ¶å°é”™è¯¯`);
                    } else {
                        log('æ²¡æœ‰æ£€æµ‹åˆ°æ§åˆ¶å°é”™è¯¯');
                    }
                    
                    // æ˜¾ç¤ºç»“æœ
                    if (issues.length === 0) {
                        resultDiv.textContent = 'âœ… æµè§ˆå™¨ç¯å¢ƒæ­£å¸¸';
                        resultDiv.className = 'status success';
                    } else {
                        resultDiv.textContent = `âš ï¸ å‘ç°é—®é¢˜: ${issues.join(', ')}`;
                        resultDiv.className = 'status warning';
                    }
                }, 1000);
                
            } catch (error) {
                log(`ç¯å¢ƒæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                resultDiv.textContent = `âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥: ${error.message}`;
                resultDiv.className = 'status error';
            }
        }

        // 4. æ¨¡æ‹ŸquickLogin
        function quickLogin(role) {
            log(`quickLoginå‡½æ•°è¢«è°ƒç”¨ï¼Œè§’è‰²: ${role}`, 'success');
            const resultDiv = document.getElementById('quickResult');
            
            try {
                log('å¼€å§‹æ¨¡æ‹Ÿç™»å½•æµç¨‹');
                
                // æ¨¡æ‹ŸåŸå§‹é€»è¾‘
                const credentials = {
                    student: { email: 'student@example.com', password: 'testpass123' },
                    parent: { email: 'parent@example.com', password: 'testpass123' }
                };
                
                const cred = credentials[role];
                log(`ä½¿ç”¨å‡­æ®: ${cred.email}`);
                
                // æ¨¡æ‹Ÿè®¾ç½®localStorage
                localStorage.setItem('auth_token', `demo-token-${role}-${Date.now()}`);
                localStorage.setItem('user_email', cred.email);
                localStorage.setItem('user_role', role);
                log('æ¨¡æ‹Ÿç”¨æˆ·ä¿¡æ¯å·²è®¾ç½®');
                
                resultDiv.textContent = `âœ… ${role}ç™»å½•æ¨¡æ‹ŸæˆåŠŸï¼`;
                resultDiv.className = 'status success';
                
                // æ¨¡æ‹Ÿè·³è½¬ï¼ˆä½†ä¸å®é™…è·³è½¬ï¼‰
                log('æ¨¡æ‹Ÿè·³è½¬åˆ°dashboardï¼ˆæœ¬é¡µé¢ä¸ä¼šå®é™…è·³è½¬ï¼‰');
                setTimeout(() => {
                    alert(`æ¨¡æ‹Ÿ${role}ç™»å½•æˆåŠŸï¼\n\nå¦‚æœè¿™ä¸ªalertèƒ½æ˜¾ç¤ºï¼Œè¯´æ˜JavaScriptåŸºæœ¬åŠŸèƒ½æ­£å¸¸ã€‚\n\nå®é™…åº”ç”¨ä¸­åº”è¯¥ä¼šè·³è½¬åˆ°dashboardé¡µé¢ã€‚`);
                }, 1000);
                
            } catch (error) {
                log(`quickLoginæ¨¡æ‹Ÿå¤±è´¥: ${error.message}`, 'error');
                resultDiv.textContent = `âŒ æ¨¡æ‹Ÿç™»å½•å¤±è´¥: ${error.message}`;
                resultDiv.className = 'status error';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–');
            setupEventTests();
            log('äº‹ä»¶æµ‹è¯•å™¨è®¾ç½®å®Œæˆ');
            
            // æ£€æŸ¥é¡µé¢ä¸­æ˜¯å¦æœ‰è¦†ç›–å±‚æˆ–é˜»æŒ¡å…ƒç´ 
            const body = document.body;
            const computedStyle = window.getComputedStyle(body);
            log(`bodyçš„pointer-events: ${computedStyle.pointerEvents}`);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±è¦†ç›–å±‚
            const allElements = document.querySelectorAll('*');
            let overlayCount = 0;
            allElements.forEach(el => {
                const style = window.getComputedStyle(el);
                if (style.position === 'fixed' && style.zIndex > 1000) {
                    overlayCount++;
                    log(`å‘ç°å¯èƒ½çš„è¦†ç›–å±‚: ${el.tagName}.${el.className}`, 'warning');
                }
            });
            
            if (overlayCount === 0) {
                log('æ²¡æœ‰æ£€æµ‹åˆ°è¦†ç›–å±‚å…ƒç´ ');
            }
            
            log('åˆå§‹åŒ–å®Œæˆï¼Œè¯·å¼€å§‹æµ‹è¯•');
        });

        // å…¨å±€é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            log(`å…¨å±€é”™è¯¯: ${e.message} åœ¨ ${e.filename}:${e.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            log(`æœªå¤„ç†çš„Promiseé”™è¯¯: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>