明白了，我将以 master 分支为基准，分析当前系统功能状态，并结合你项目的目标（如积分规则、任务确认、家长审批、积分兑换与统计等）列出下一阶段需要推进的 TODO 工作清单。这份清单将包括开发、测试、合并、部署、前端同步等维度的工作内容，确保你能高效推进下一阶段。


# 下一阶段 TODO 清单

## 高优先级 🔴

* **【全栈】合并积分统计修复分支并部署：**将`fix/statistics-and-points-system`分支中修复**积分统计系统**的代码合并回 master 主分支，并在部署前进行充分测试。确保任务完成后积分计算、统计汇总（如每周完成率、总积分等）都准确无误，解决当前主干中统计/积分逻辑可能存在的错误。

* **【前端】家长兑换请求审批功能：**实现家长端对**积分兑换特殊奖励**的审批界面。在家长控制台增加查看**待审批兑换请求**的模块，列出孩子提交的奖励兑换申请（及所耗积分），允许家长一键批准或拒绝并填写备注。这将补全“积分兑换与统计”流程，确保孩子兑换特殊奖励需经过家长确认，避免未审批就扣减积分的情况。

* **【后端】积分机制平衡优化与测试：**针对现有**积分奖励机制**进行验证和优化。重点包括：检查**每日积分上限**（目前全局20分）和各活动类别上限是否正确生效，调整`pointsRules`配置以平衡不同任务难度与积分奖励。例如，可根据任务难度/耗时重新校准`calculateConfigurablePoints`算法，确保简单任务与困难任务积分比例合理。同时编写单元测试覆盖积分计算、每日上限截断、附加奖励等逻辑，保证积分发放公平且无漏洞。

* **【前端/后端】关键用户流程集成测试：**在开发完成以上改动后，进行端到端测试。涵盖**任务规划->完成->家长审批->积分到账**、**积分兑换->家长审批->奖励发放**、**游戏时间兑换->使用->统计更新**等完整流程。确保前后端交互正确（例如任务完成后家长审批通过才真正给积分；兑换游戏时间扣积分并增加可用游戏时长等），并修复测试中发现的 bug，为上线做准备。

## 中等优先级 🟠

* **【全栈】高级任务规划与日程冲突检测：**将`EnhancedTaskPlanning`高级规划功能完善并上线。前端提供**两种模式**（简单/高级）：高级模式下用户可为任务设置具体开始时间、优先级、提醒等，并调用后端新增接口进行**冲突检查**。需要在后端实现`GET /daily-tasks/weekly-schedule`（返回用户当周任务安排）和`GET /daily-tasks/check-conflicts`（给定日期和时间段返回是否与已规划任务冲突及建议方案）等接口，支持前端的日程冲突提示。完成后在前端 TaskPlanning 页面增加“高级规划”开关，供需要精细日程管理的用户使用。

* **【前端】任务库管理与自定义任务：**完善**任务规划与记录**功能，允许用户（家长）新增自定义任务到任务库。实现 TaskLibrary 组件中的“添加任务”表单，填写标题、类别、预计时长、难度、积分等属性后，经后端`POST /tasks`保存。这样孩子在规划时可选择个性化任务，丰富任务库内容。同时在前端任务列表中增加按类别筛选/搜索功能，提升任务查找效率。

* **【前端】积分历史与成就展示：**利用后端提供的数据丰富**积分统计**前端展示。实现“积分历史”查看（调用`GET /auth/points-history`接口）以列表形式显示积分获取和支出明细；在用户仪表盘或成就广场展示更多成就徽章和统计（例如周完成任务数、当前等级及下一等级所需积分）。这些改进将使用户对自己**积分获取/使用**和成长进度有更直观认识。

* **【前端】游戏时间使用前端支持：**在**游戏时间控制**方面，增加儿童端开始/结束游戏时间的交互。提供“开始游戏”按钮，孩子点击时选择使用的分钟数并调用后端`POST /rewards/game-time/use`接口记录一次游戏会话。前端应实时显示倒计时，提醒剩余可玩时间并在用完时提示“游戏时间已耗尽”。确保游戏时间的**基础30分钟**和兑换所得时间都计入可用总时长，并在每日基础时间刷新时更新显示。这一功能将真正落地“游戏时间控制”，避免仅通过兑换而缺少实际使用监管。

## 低优先级 🟢

* **【后端】功能完善与数据校验：**进一步完善系统边角功能。例如，实现**任务跳过/逾期处理**：每日结束时对仍为“计划中”的任务标记为“跳过”（skipped）并在统计中计入；为`DailyTask`增加跳过任务的API或由家长手动标记跳过。增加更多数据校验和安全措施，如限制证据上传文件类型大小、避免重复提交任务等，提高系统健壮性。

* \*\*【部署】配置优化与发布准备：\*\*在部署前清理并优化配置参数。将 JWT 密钥、数据库连接等敏感信息配置为环境变量（替换开发默认值）；运行`create-database-indexes.js`等脚本以创建必要索引提升查询性能（例如任务/积分统计聚合性能）。配置 `ecosystem.config.js` 确认日志、崩溃重启策略符合生产需要。考虑设置 CI/CD 流程，在合并主干时自动运行测试和部署，以降低人为失误风险。

* \*\*【前端】UX 改进与多端适配: \*\*根据测试反馈进行一些用户体验改进。例如：在孩子提交任务完成证据后给予明确提示等待家长审批；家长端当有待审批事项时在导航栏显示红点提醒；确保移动端页面布局友好，提升不同设备上的易用性。虽然这些不影响核心功能，但能提高用户满意度。

* **【全栈】性能监控与持续优化：**上线后加入对**积分与任务**关键流程的性能监控。比如每日定时统计任务可能涉及聚合计算，应观察其耗时和数据库负载，必要时进行优化（如增加缓存、分批处理等）。对游戏时间、积分兑换等高频操作，关注日志确保没有异常。此外，逐步补充自动化测试（单元测试+集成测试）覆盖主要模块，作为持续交付的一部分，确保今后改动不引入回归问题。

以上任务按优先级排列，开发团队可据此逐项执行，优先保障核心目标功能完善和系统稳定，然后再着手扩展和优化。每项任务都附有简要说明和实现建议，以便开发人员迅速理解需求并开展工作。
